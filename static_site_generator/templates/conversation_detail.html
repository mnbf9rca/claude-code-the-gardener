{% extends "base.html" %}

{#
  SECURITY NOTE: XSS false positives
  The | safe filter is used intentionally in this template to render pre-formatted HTML
  from trusted Python formatter functions. All content comes from local data files,
  not user input. This is a static site generator, not a web application.
#}

{% block title %}Conversation {{ conversation.session_id[:8] }} - Claude the Gardener{% endblock %}

{% block content %}
<div class="conversation-detail">
    <header class="page-header">
        <h1>= Conversation Details</h1>
        <p class="subtitle">Session ID: {{ conversation.session_id }}</p>
    </header>

    <div class="conversation-meta">
        <div class="meta-item">
            <span class="meta-label">Started:</span>
            <span class="meta-value">{{ conversation.start_time }}</span>
        </div>
        <div class="meta-item">
            <span class="meta-label">Duration:</span>
            <span class="meta-value">{{ conversation.duration_human }}</span>
        </div>
        <div class="meta-item">
            <span class="meta-label">Messages:</span>
            <span class="meta-value">{{ conversation.message_count }}</span>
        </div>
        <div class="meta-item">
            <span class="meta-label">Tool Calls:</span>
            <span class="meta-value">{{ conversation.tool_call_count }}</span>
        </div>
        <div class="meta-item">
            <span class="meta-label">Tokens:</span>
            <span class="meta-value">{{ (conversation.tokens.input + conversation.tokens.output) | format_number }}</span>
        </div>
        <div class="meta-item">
            <span class="meta-label">Cost:</span>
            <span class="meta-value">${{ "%.4f"|format(conversation.cost_usd) }}</span>
        </div>
    </div>

    <div class="messages">
        {% for message in conversation.messages %}
        <div class="message message-{{ message.role }}">
            <div class="message-header">
                <span class="message-role">
                    {% if message.role == 'assistant' %}
                    Claude
                    {% elif message.role == 'user' %}
                    System
                    {% else %}
                    {{ message.role }}
                    {% endif %}
                </span>
                <span class="message-time">{{ message.timestamp }}</span>
            </div>
            <div class="message-content">
                {% if message.content %}
                <div class="message-text">{{ message.content_html | safe }}</div>
                {% endif %}

                {% if message.tool_calls %}
                <div class="tool-calls">
                    {% for tool in message.tool_calls %}
                    <div class="tool-call-block" id="tool-{{ tool.id }}">
                        <div class="tool-call">
                            <div class="tool-header">
                                <span class="tool-icon">='</span>
                                <span class="tool-name">{{ tool.name }}</span>
                            </div>
                            <div class="tool-input">{{ tool.input_html | safe }}</div>
                        </div>
                        {% if tool.result %}
                        <div class="tool-result {% if tool.result.is_error %}tool-error{% endif %}">
                            <div class="result-label">Result:</div>
                            <div class="result-content">{{ tool.result.content_html | safe }}</div>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="conversation-nav">
        <a href="index.html" class="nav-btn"> Back to Conversations</a>
    </div>
</div>
{% endblock %}
